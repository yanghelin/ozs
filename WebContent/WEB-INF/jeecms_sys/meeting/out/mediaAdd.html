<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<!-- <script src="${base}/thirdparty/swfupload/swfupload.js" type="text/javascript"></script>
<script src="${base}/thirdparty/swfupload/swfupload.queue.js" type="text/javascript"></script>
<script src="${base}/thirdparty/swfupload/fileprogress.js" type="text/javascript"></script>
<script src="${base}/thirdparty/swfupload/handlers.js" type="text/javascript"></script>
<link href="${base}/thirdparty/swfupload/process.css" rel="stylesheet" type="text/css"/> -->
<title></title> <#include "/jeecms_sys/head.html"/>
<script src="${base}/res/common/js/ajaxfileupload.js" type="text/javascript"></script>
<script type="text/javascript">
	$(function() {
		$("#jvForm").validate();
		//部门对话框
		$("#departDialog").dialog({
			autoOpen : false,
			modal : true,
			width : 280,
			height : 420,
			position : [ "center", 20 ],
			buttons : {
				"OK" : function() {
					$("#departId").val($("input[name='departId']:checked").val());
					$("#departName").val($("input[name='departId']:checked+span").html());
					$(this).dialog("close");
				}
			}
		});
		var parent_opened = false;
		$('#depart').click(function() {
			//第一次打开，需要获取数据。
			if (!parent_opened) {
				$("#departTree").treeview({
					url : "v_depart_add.do"
				});
				parent_opened = true;
				$("#departDialog").show();
			}
			$('#departDialog').dialog('open');
			return false;
		});
	});
	function allChannelSelect() {
		$("#allChannelHide").val($("#allChannel").prop("checked"));
	}
	function allControlChannelSelect() {
		$("#allControlChannelHide").val($("#allControlChannel").prop("checked"));
	}
	
</script>
</head>
<body>
	<div class="box-positon">
		<div class="rpos"><@s.m "global.position"/>: <@s.m "out.meeting.manager"/> - <@s.m "global.add"/></div>
		<form class="ropt">
			<input type="submit" value="<@s.m "global.backToList"/>" onclick="this.form.action='list.do';" class="return-button"/>
		</form>
		<div class="clear"></div>
	</div>
	<div class="body-box">
		<#assign usernameExist><@s.m "error.usernameExist"/></#assign>
		<@p.form id="jvForm" action="mediaSave.do" labelWidth="12">
		<@p.text width="50" colspan="1" label="out.cnName" name="cnName" required="true" maxlength="20" />
		<@p.radio width="50" colspan="1" label="out.sex" required="true" name="sex" value="0" list={"0":"cmsUser.male","1":"cmsUser.female"} />
		<@p.tr/>
		<@p.text width="50" colspan="1" label="out.unit" name="unit" required="true" maxlength="100"/>
		<@p.text width="50" colspan="1" label="meeting.position" name="position" required="true" maxlength="20"/>
		<@p.tr/>
		<@p.radio width="50" colspan="1" label="out.meeting.userType" required="true" name="userType" value="2" list={"2":"速记","3":"媒体"} />
		<@p.text width="50" colspan="1" label="meeting.phone" name="phone" required="true" maxlength="20"/>
		<@p.tr/>
		<@p.text width="50" colspan="1" label="out.email" name="email" required="true" maxlength="100"/>
		
		<@p.td colspan="1" label="out.other">
			<input type="hidden" name="otherId" id="otherId" />
			<input type="file" id="otherFile" name="otherFile" value="浏览" style="width:200px;"/>
			<input type="button" value="上传" onclick="myFileUpload('otherFile','otherId')"/>
			<span id="otherIdSpan"></span>
		</@p.td>
		<@p.tr/>
		<@p.td colspan="2">
			<span style="color:red;float:left;margin-left:20px;">注：为方便会议结束后借款，请正确填写信息。</span>
		</@p.td>
		<@p.tr/>
		<@p.text width="50" colspan="1" label="out.bankNo" name="bankNo" required="true" maxlength="25"/>
		<@p.text width="50" colspan="1" label="out.bankAddress" name="bankAddress" required="true" maxlength="100"/><@p.tr/>
		<@p.text width="50" colspan="1" label="out.bankName" name="bankName" required="true" maxlength="100"/>
		<@p.text width="50" colspan="1" label="out.bankCard" name="bankCard" required="true" maxlength="20"/><@p.tr/>
		<@p.td colspan="2"><@p.submit code="global.submit"/> &nbsp; <@p.reset code="global.reset"/></@p.td><@p.tr/>
		</@p.form>
	</div>
	<script type="text/javascript">
		var uploadCount=0;
		//打开的csv窗口，点击其中的上传方法调用此方法
	 	function myFileUpload(fileId, busId) {
	 		uploadCount++;
	 		var myfile = $("#"+fileId).val();
	 		
	 		if(isEmpty(myfile)) {
	 			alert("请选择文件");
	 			return false;
	 		}else {
	 			/* var myfiles = myfile.substring(myfile.lastIndexOf(".")+1,myfile.length);
	 			if(isEmpty(myfiles) || myfiles != "doc" || myfiles != "docx" || myfiles != "xls" || myfiles != "xlsx" || myfiles != "pdf") {
	 				alert("导入文件类型不正确，请重新选择文件");
	 				return false;
	 			}else { */
	 				var filesize = findSize(busId);
	 				filesize = parseInt(filesize);
	 				if(parseInt(filesize)>100) {
	 					alert("导入文件超过100M，请重新上传。");
	 	 				return false;
	 				}
	 			//}
	 			
	 		}
	 		var myfile_start_pos = myfile.lastIndexOf("/");
	 		if(myfile_start_pos<0) {
	 			myfile_start_pos = myfile.lastIndexOf("\\");
	 		}
	 		//回显上传文件名称
	 		var file_name = myfile.substring(myfile_start_pos+1, myfile.length);
	 		var url = "other_upload.do";
			jQuery.ajaxFileUpload({
				id:uploadCount,
		        //处理文件上传操作的服务器端地址(可以传参数,已亲测可用)  
		        url:url,  
		        secureuri:false,                           //是否启用安全提交,默认为false   
		        fileElementId:fileId,               //文件选择框的id属性  
		        dataType:'json',                       //服务器返回的格式,可以是json或xml等  
		        data:{},
		       	success: function(data, status) {
	 	          	if(data.code == 200) {
 	          			$("#"+busId).val(data.busId);
 	          			$("#"+busId+"Span").text(decodeURI(data.fileName));
	 	          	}else {
		 	          	alert(data.message);
	 	          	}
	 	        },error: function (data, status, e) {
	 	        	alert("导入失败");
	 	        }
	 	    });
	 	}
	 	function isEmpty(obj) {
			if(obj == null || obj == undefined || obj == '' || obj.toString().trim() == '') {
				return true;
			}
			return false;
		}
	 	function findSize(field_id){
			var fileInput = $("#"+field_id)[0];
			if(fileInput.files) {
				byteSize  = fileInput.files[0].size;
			}else {
				byteSize = 1;
			}
			return (Math.ceil(byteSize/(1024*1024))); // Size returned in KB.
		}
	</script>
</body>
</html>